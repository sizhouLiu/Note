# 利用Python对文件进行排序

#### 前言：

昨天我的大憨批同学和我诉苦，老师让他按学号排序，而文件是无序的，一听就是个扯淡工作，去网上查找没有找到什么简便的办法，去问GPT，GPT让我写脚本，略加思索，应该没问题开工。

![image-20230530160510294](https://s1.ax1x.com/2023/05/31/p9vGLwR.png)

#### 需求分析：

![image-20230530160942960](https://s1.ax1x.com/2023/05/31/p9vGOT1.png)

有一个这样的表格，要将文件按照表格中的学号依次排序

![image-20230530161034863](https://s1.ax1x.com/2023/05/31/p9vJl0s.png)

那么很容易想到的就是先用xlrd库来取到第一列

```python
excel = xlrd.open_workbook("D:\垃圾项目\\test\中国女性婚姻生活史结课论文\中国女性婚姻生活史—上课名单.xlsx")  # 打开excel文件
sheet = excel.sheet_by_index(0)
print(sheet.col_values(0))
```

输出：

```python
['学号', '202200506101', '202200506120', '202201107111', '202201107207', '202201107321', '202101107430', '202100504115', '202200505208', '202200505209', '202201103144', '20200320301010', '202100101145', '202100101348', '202200101112', '202200101133', '202200101139', '202200101144', '202200101146', '202200101149', '202200101156', '202200101163', '202200101165', '202200101260', '202200101262', '202200101264', '202200101345', '202200101346', '202200101351', '202200101353', '202200101354', '202200101355', '202201204121', '202201204123', '202201204129', '202201204133', '202201204166', '202201204250', '202201204329', '201901001207', '202200203408', '202200203410', '202204001605', '202204001607', '202204001609', '202204001631', '202204001646', '202204001647', '202200201241', '202200202306', '202201818110', '202201818315', '202200903145', '202200903165', '202200903220', '202200903242', '202109032086', '202201601329', '202201601330', '202200901140', '202202201101', '202100205117', '20200160401006', '202101704205', '202101704206', '202101704207', '202101704210', '202201101209', '202201101227', '202201101237', '202201101261', '202201101263', '202200103127', '202200103130', '202200103135', '202200103147', '202200103149', '202200103151', '202200103152', '202200103157', '202203203116', '202203203143', '202203203170', '202101304248', '202203203238', '202203203244', '202103203221', '202103203251', '202109032078', '202101701439', '202101701442', '202200501104', '202200501116', '202200501130', '202103041048', '202103041053', '202203041012', '202203041017', '202203041052', '202203041054', '202203041066']
```

由于文件的命名格式并不规整，好在里面只有学号一个数字，可以套正则。

读取文件夹中文件

```python
file_dir = "test/中国女性婚姻生活史结课论文"
files = os.listdir(file_dir)
```

 

```python
['10、202200103152张佳璐 电影史上女性主义的兴起与发展.docx', '11、202200501116 龙琳 《从简爱和红楼梦看中西方女性意识的发展》.docx', '1、202200506101 白苏雅 德国妇女地位和女性意识的发展.docx', '2、202100101145 王梓婧 文学中的经典女性形象及其影响.docx', '3、202200101163 周驰恒.docx', '4、202201204329寇亦菲从古代女子服饰变化看女子地位的转变.docx', '5、202204001609   贾博杨   宋代女子真的是最保守的吗.docx', '6、202204001646杨钰尧-新民主主义革命以来中国的妇女解放.docx', '7、202201818110刘依凡（我眼中的爱情）.docx', '8、202202201101-蔡曜琦-《中国妇女妆粉文化发展历程》.docx', '9、202200103135田家昕论性别平等与女性赋权.docx',]
```

写正则取出数字

```python
files_change = []

for i in files:
    obj = re.search(r'\d{12}',i)
    try:
        files_change.append(obj.group(0))
    except:
        pass
```

```python
files_change = ['202100101145', '202200101163', '202200103135', '202200103152', '202200501116', '202200506101', '202201204329', '202201818110', '202202201101', '202204001609', '202204001646']
```

将数据按照表格中学号顺序来排序具体原理是首先把文件的学号和表格中学号的数据做一个映射，用字典也可以，我这里用了zip函数。然后对其按照第二个list排序如果第二个一样就按照第一个排序（其实我感觉可以优化掉但是不想动脑子了）然后用遍历表格中的学号去查找这个值有没有在y_axis，如果有就添加到新list中，这样就做到了将y_axis按照表格中的顺序去排序，之后同样的逻辑遍历y_axis的下标和值，如果a在i里那么就可以将这个元素的下标对应的值添加到z_axis里 从而将名字按照表格中学号排列。

```python
a = list(zip(files,files_change))
sort_zipped = sorted(a,key=lambda x:(x[1],x[0]))
result = zip(*sort_zipped)

x_axis, y_axis = [list(x) for x in result]
y_axis = [item for item in sheet.col_values(0) if item in y_axis]
z_axis = []

for a in y_axis:
    for index,i in enumerate(files_change):
        try:
            if a in i:
                z_axis.append(x_axis[index])
        except:
            pass
```

```python
['202200506101 白苏雅 德国妇女地位和女性意识的发展.docx', '202100101145 王梓婧 文学中的经典女性形象及其影响.docx', '202200101163 周驰恒.docx', '202201204329寇亦菲从古代女子服饰变化看女子地位的转变.docx', '202204001609   贾博杨   宋代女子真的是最保守的吗.docx', '202204001646杨钰尧-新民主主义革命以来中国的妇女解放.docx', '202201818110刘依凡（我眼中的爱情）.docx', '202202201101-蔡曜琦-《中国妇女妆粉文化发展历程》.docx', '202200103135田家昕论性别平等与女性赋权.docx', '202200103152张佳璐 电影史上女性主义的兴起与发展.docx', '202200501116 龙琳 《从简爱和红楼梦看中西方女性意识的发展》.docx']
```

可以看到顺序是和表格中的一样的![image-20230530160942960](https://s1.ax1x.com/2023/05/31/p9vGOT1.png)

```python
n = 1
for i in z_axis:
    a = f"test/中国女性婚姻生活史结课论文/{n}、{i}"
    os.rename(f"test/中国女性婚姻生活史结课论文/{i}",a)
    n += 1
```

#### 全部代码：

```python
# -*- coding: utf-8 -*-
import re
import os
import xlrd

file_dir = "test/中国女性婚姻生活史结课论文"
files = os.listdir(file_dir)

excel = xlrd.open_workbook("D:\垃圾项目\\test\中国女性婚姻生活史结课论文\中国女性婚姻生活史—上课名单.xlsx")  # 打开excel文件
sheet = excel.sheet_by_index(0)

files_change = []

for i in files:
    obj = re.search(r'\d{12}',i)
    try:
        files_change.append(obj.group(0))
    except:
        pass

a = list(zip(files,files_change))
sort_zipped = sorted(a,key=lambda x:(x[1],x[0]))
result = zip(*sort_zipped)

x_axis, y_axis = [list(x) for x in result]
y_axis = [item for item in sheet.col_values(0) if item in y_axis]
z_axis = []

for a in y_axis:
    for index,i in enumerate(files_change):
        try:
            if a in i:
                z_axis.append(x_axis[index])
        except:
            pass
#
# print(y_axis)
print(z_axis)
n = 1
for i in z_axis:
    a = f"test/中国女性婚姻生活史结课论文/{n}、{i}"
    os.rename(f"test/中国女性婚姻生活史结课论文/{i}",a)
    n += 1
```

#### 结语：![1685491469195](https://s1.ax1x.com/2023/05/31/p9vGxfK.png)

这件事情本身难度不大，但是我一开始搞错了需求，把学号按大小排列了一下，浪费了半个多小时。一开始我以为可以按照顺序去挨个保存文件以达到排序文件的目的，结果我发现他是按照分钟为单位排序的，如果要那样做的话起码要三四个小时才能把程序跑完，这样显然很扯淡，所以我就在文件前面加序号来排序了。另外我又重新学了list按照另一个list的顺序排序的算法，一开始脑子没转过来，把脑子干烧了。总之还算顺利的把这件任务完成了。以后也许能解决更多问题吧。（话说是不是应该去画个GUI封装一下比较好？）（不过也扯淡，封装了业务变动又没用了）

